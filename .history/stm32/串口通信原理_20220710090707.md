# 串行通信接口背景知识

---

## 处理器与外部设备通信的两种方式

* 并行通信

    * 传输原理:数据各个位同时传输.
    * 优点:速度快
    * 缺点:占用引脚资源多

* 串行通信
    * 传输原理:数据按位顺序传输
    * 优点:占用引脚资源少
    * 缺点:速度相对较慢

---

## 串行通信:

**按照数据传送方向,分为:**
* 单工:

    **数据传输只支持数据在一个方向上传输**

* 半双工:

    **允许数据在两个方向上传输,但是,在某一时刻,只允许数据在一个方向上传输,它实际上是一种切换方向的单工通信;**

* 全双工:

    **允许数据同时在两个方向上传输,因此,全双工通信时两个单工通信方式的结合,它要求发送设备和接受设备都有独立的接受和发送能力**

![](../图片/串行通信的三种模式.png)

---

## 串行通信的通信方式

* 同步通信：带时钟同步信号传输
-SPI，IIC通信接口
* 异步通信：不带时钟同步信号
-UART(通用异步收发器)，单总线

---

## 常见的串行通信接口：
|       通信标准       |                            引脚说明                             | 通信方式 | 通信方向 |
| :------------------: | :-------------------------------------------------------------: | :------: | :------: |
| UART(通用异步收发器) |               TXD：发送端 RXD:接收端 GND：公共地                | 异步通信 |  全双工  |
|  单总线（1——wire）   |                         DQ：发送/接受端                         | 异步通信 |  半双工  |
|         SPI          | SCK：同步时钟 MISO：主机输入，从机输出 MOSI：主机输出，从机输入 | 同步通信 |  全双工  |
|         I2C          |               SCL：同步时钟 SDA：数据输入/输出端                | 同步通信 |  半双工  |

---

# STM32F1串口框图讲解

---

## STM32的串口通信接口

* UART:通用异步收发器
* USART：通用同步异步收发器

        大容量STM32F10x系列芯片，包含3个USART和2个UART

---

### UART异步通信方式引脚连接方法：

-RXD：数据输入引脚，数据接受。
-TXD：数据发送引脚，数据发送。

![](../图片/UART引脚连接.png)

* UART异步通信方式引脚：

![](../图片/UART串口引脚.png)

---

### UART异步通信方式特点：

* 全双工异步通信
* 分数波特率发生器系统，提供精确的波特率 -发送和接受共用的可编程波特率，最高可达4.5Mbits/s
* 可编程的数据字长度（8位或者9位）
* 可配置的停止位（支持1或者2位停止位）
* 可配置的使用DMA多缓冲器通信
* 单独的发送器和接受器使能位
* 检测标志：
  1. 接受缓冲器
  2. 发送缓冲器空
  3. 传输结束标志
* 多个带标志的中断源。触发中断
* 其他：校验控制，四个错误检测标志

---

### 串口通信过程

![](../图片/串口通信过程.png)

---

### STM32串口异步通信需要定义的参数

1. 起始位
2. 数据位（8位或者9位）
3. 奇偶校验位（第九位）
4. 停止位（1，15，2位）
5. 波特率设置

* **范例**
![](../图片/串口定义参数.png)

---

### 串口框图

> STM32中文开发手册第25章

---

# STM32串口常用寄存器和库函数

---

### 常用的串口相关寄存器

* USART_SR状态寄存器
* USART_DR数据寄存器
* USART_BRR波特率寄存器

---

### 串口操作相关库函数（省略入口参数）：

        USART_Init(); //串口初始化：波特率，数据字长，奇偶校验，硬件流控以及收发使能
        void USART_Cmd();//使能串口
        void USART_ITConfig();//使能相关中断

        void USART_SenData();//发送数据到串口，DR
        uint16_t USART_ReceiveData();//接受数据，从DR读取接收到的数据

        FlagStatus USART_GetFlagStatus();//获取状态标志位
        void USART_ClearFlag();//清除状态标志位
        ITStatus USART_GetITStatus();//获取中断状态标志位
        void USART_ClearITPendingBit();//清除中断状态标志位

---

# 串口配置方法

1. 串口时钟使能，GPIO时钟使能：RCC_APB2PeriphClockCmd();
2. 串口复位：USART_DeInit();*这一步不是必须的*
3. GPIO端口模式设置：GPIO_Init();*模式设置为GPIO_Mode_AF_PP*
4. 串口参数初始化：UART_Init();
5. 开启中断并且初始化NVIC（**如果需要开启中断才需要这个步骤**）
    NVIC_Init();
    USART_ITConfig();
6. 使能串口：USART_Cmd();
7. 编写中断处理函数：USARTx_IRQHandler();
8. 串口数据收发：
    void USART_SenData();//发送数据到串口，DR
    uint16_t USART_ReceiveData();//接受数据，从DR读取接收到的数据
9. 串口传输状态获取：
    FlagStatus USART_GetFlagStatus(USART_TypeDef* USARTx,uint16_t USART_Flag);//获取状态标志位
    void USART_ClearITPendingBit(USART_TypeDef* USARTx,uint16_t USART_IT);//清除中断状态标志位
    

---

# 串口通信实验讲解

---

### 串口配置的一般步骤



---

### 串口通信代码讲解




---

> <STM32F1开发指南-库函数版本>
> >5.3usart串口文件夹介绍
> >第九章 串口实验